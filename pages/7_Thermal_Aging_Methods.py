import numpy as np
import plotly.graph_objects as go
from plotly.subplots import make_subplots
from scipy.optimize import curve_fit
import streamlit as st

st.title("Thermal Accelerated Aging Methods")

st.markdown(
    """
    Digitized curves from **"Thermal Accelerated Aging Methods for Magnet Wire – A Review"** to
    visualize thermogravimetry, dielectric loss, dynamic mechanical response, and capacitance drift.
    Hover on any curve to read exact values; polynomial fits overlay the provided points for quick trend
    estimation. Use the paper for authoritative data and context.
    """
)

st.markdown(
    "Reference: https://www.researchgate.net/publication/327607082_Thermal_Accelerated_Aging_Methods_for_Magnet_Wire_A_Review"
)
def _sigmoid(x, L, x0, k, b):
    return L / (1 + np.exp(-k * (x - x0))) + b


def _elliptic_curve(x, x0, a, b, y0):
    inside = 1 - ((x - x0) / a) ** 2
    return y0 + b * np.sqrt(np.clip(inside, 0, None))


def add_trace_with_fit(fig, row, col, name, x, y, degree, x_label, y_label, color, fit_type="chebyshev"):
    x = np.array(x)
    y = np.array(y)
    x_dense = np.linspace(float(x.min()), float(x.max()), 400)

    fig.add_trace(
        go.Scatter(
            x=x,
            y=y,
            mode="markers",
            name=f"{name} points",
            marker=dict(color=color, size=6, symbol="circle"),
            hovertemplate=f"{x_label}: %{{x:.2f}}<br>{y_label}: %{{y:.4g}}<extra></extra>",
        ),
        row=row,
        col=col,
    )

    if fit_type == "sigmoid":
        try:
            L_guess = float(y.max() - y.min())
            x0_guess = float(x.mean())
            k_guess = 0.01
            b_guess = float(y.min())
            popt, _ = curve_fit(_sigmoid, x, y, p0=[L_guess, x0_guess, k_guess, b_guess])
            fit_y = _sigmoid(x_dense, *popt)
            coeff_text = f"L={popt[0]:.4g}, x0={popt[1]:.4g}, k={popt[2]:.4g}, b={popt[3]:.4g}"
        except Exception:
            cheb = np.polynomial.Chebyshev.fit(x, y, degree, domain=[float(x.min()), float(x.max())])
            fit_y = cheb(x_dense)
            coeffs = cheb.convert().coef
            coeff_text = f"Cheb coeffs: {np.round(coeffs, 4)}"
    elif fit_type == "elliptic":
        try:
            x0_guess = float(x.mean())
            a_guess = float((x.max() - x.min()) / 2) or 1.0
            b_guess = float((y.max() - y.min()) / 2) or 1.0
            y0_guess = float(y.min())
            popt, _ = curve_fit(_elliptic_curve, x, y, p0=[x0_guess, a_guess, b_guess, y0_guess], maxfev=20000)
            fit_y = _elliptic_curve(x_dense, *popt)
            coeff_text = f"x0={popt[0]:.4g}, a={popt[1]:.4g}, b={popt[2]:.4g}, y0={popt[3]:.4g}"
        except Exception:
            cheb = np.polynomial.Chebyshev.fit(x, y, degree, domain=[float(x.min()), float(x.max())])
            fit_y = cheb(x_dense)
            coeffs = cheb.convert().coef
            coeff_text = f"Cheb coeffs: {np.round(coeffs, 4)}"
    else:
        cheb = np.polynomial.Chebyshev.fit(x, y, degree, domain=[float(x.min()), float(x.max())])
        fit_y = cheb(x_dense)
        coeffs = cheb.convert().coef
        coeff_text = f"Cheb coeffs: {np.round(coeffs, 4)}"

    fig.add_trace(
        go.Scatter(
            x=x_dense,
            y=fit_y,
            mode="lines",
            name=f"{name} fit ({fit_type})",
            line=dict(color=color, dash="dash"),
            hovertemplate=f"{x_label}: %{{x:.2f}}<br>{y_label}: %{{y:.4g}}<extra></extra>",
        ),
        row=row,
        col=col,
    )
    fig.add_annotation(
        row=row,
        col=col,
        xref="x domain",
        yref="y domain",
        x=0.99,
        y=0.05,
        xanchor="right",
        yanchor="bottom",
        text=f"{name} fit coeffs: {coeff_text}",
        font=dict(size=10),
        showarrow=False,
        bgcolor="rgba(255,255,255,0.7)",
    )


st.header("Figure 2 – Thermogravimetry (Weight % vs Temperature)")
st.caption("Weight stability and onset of mass loss for different conductor/insulation systems.")
thermograv_data = {
    "Copper": [
        (20.05589161272067, 99.99259259259259),
        (61.31380664331954, 100.0074074074074),
        (103.3442994092469, 99.97777777777777),
        (135.43457497612226, 99.98518518518517),
        (176.6939049842584, 99.99259259259259),
        (201.14471682762039, 99.99259259259259),
        (253.8611199547207, 100.02222222222221),
        (292.82677137500445, 100.03703703703704),
        (329.500159184973, 100.05185185185185),
        (361.58618981923667, 100.08148148148148),
        (399.7849234143407, 100.1111111111111),
        (441.03151862464176, 100.18518518518518),
        (479.9886801797021, 100.24444444444444),
        (509.7796172485762, 100.28888888888888),
        (544.914924475574, 100.35555555555555),
        (567.8304856910395, 100.39259259259259),
        (593.7981534543139, 100.45185185185184),
        (613.6559482118221, 100.4962962962963),
        (644.9665711556828, 100.58518518518518),
        (674.7504333368707, 100.66666666666666),
        (702.2420319077434, 100.74814814814815),
        (742.7061445399554, 100.91851851851851),
    ],
    "PEI": [
        (22.349570200573083, 99.98518518518517),
        (63.61456011885812, 99.96296296296296),
        (85.01609536948601, 99.92592592592592),
        (117.10920089143585, 99.91851851851851),
        (133.9191340337472, 99.91851851851851),
        (159.13403374721426, 99.91851851851851),
        (181.29399695779833, 99.91111111111111),
        (206.51031164880263, 99.9037037037037),
        (230.19986557713398, 99.88888888888889),
        (252.35558385510635, 99.9037037037037),
        (278.33598641621563, 99.89629629629628),
        (302.0241253670098, 99.88888888888889),
        (326.4735222328345, 99.89629629629628),
        (350.92857900880824, 99.87407407407407),
        (379.96674802787504, 99.85925925925925),
        (404.4458594219816, 99.71111111111111),
        (419.7559163748275, 99.56296296296296),
        (438.8807527680498, 99.44444444444444),
        (454.96055750114965, 99.26666666666667),
        (476.36350772931485, 99.22222222222221),
        (493.9502635395662, 99.15555555555555),
        (509.2560755598005, 99.02962962962962),
        (521.5126109873005, 98.86666666666666),
        (528.4247762566769, 98.68148148148147),
        (536.0911245533977, 98.54814814814814),
        (545.2714988149563, 98.48888888888888),
        (556.725741978846, 98.52592592592592),
        (574.2884431709645, 98.58518518518518),
        (595.6715837136085, 98.64444444444445),
        (617.0518943011779, 98.71851851851851),
        (633.8490926456542, 98.78518518518518),
        (658.2857547136438, 98.85925925925925),
        (678.900562453571, 98.94074074074074),
        (704.0928225264423, 99.05925925925925),
        (726.2287311188934, 99.17777777777778),
        (739.2069050903816, 99.23703703703703),
        (758.2864622024125, 99.35555555555555),
        (772.0230641338568, 99.44444444444444),
        (786.5209239803316, 99.54814814814814),
        (797.202589408893, 99.62962962962962),
    ],
    "PEI/PAI": [
        (22.350985178110307, 99.97777777777777),
        (60.55820863843789, 99.96296296296296),
        (94.17948990059784, 99.95555555555555),
        (151.4818352258658, 99.97777777777777),
        (212.61310976688245, 99.95555555555555),
        (272.21054865754, 99.96296296296296),
        (329.51996887049415, 99.94814814814814),
        (389.90272029431526, 99.84444444444443),
        (432.75814496444866, 99.4962962962963),
        (495.4741943471647, 99.17777777777778),
        (545.2134847359298, 98.79259259259258),
        (559.8089780324736, 98.38518518518518),
        (595.0249389790936, 98.02962962962962),
        (655.3581661891117, 98.18518518518518),
        (716.4370865612507, 98.43703703703703),
        (775.9694364851957, 98.78518518518518),
    ],
    "PAI": [
        (22.35381513318478, 99.96296296296296),
        (59.79412076833282, 99.96296296296296),
        (83.48933460681312, 99.91851851851851),
        (107.17747355760727, 99.91111111111111),
        (132.39520322614877, 99.89629629629628),
        (158.37136085464644, 99.91111111111111),
        (182.82075772047116, 99.91851851851851),
        (204.97930595351798, 99.91851851851851),
        (228.66744490431213, 99.91111111111111),
        (254.645017510347, 99.91851851851851),
        (277.5704835685734, 99.9037037037037),
        (300.49594962679964, 99.88888888888889),
        (328.767200820687, 99.88888888888889),
        (350.92574905373374, 99.88888888888889),
        (372.32020941667554, 99.88888888888889),
        (401.3597934132795, 99.86666666666666),
        (421.2303229686228, 99.84444444444443),
        (446.4537125473132, 99.8),
        (470.1545862959425, 99.72592592592592),
        (493.8611199547206, 99.62222222222222),
        (516.0451377834377, 99.48888888888888),
        (535.1742191092716, 99.34814814814814),
        (550.4927659273409, 99.15555555555555),
        (556.6380133715377, 98.98518518518517),
        (563.5431037532278, 98.83703703703704),
        (565.8664968693622, 98.67407407407407),
        (568.1842300753474, 98.54074074074073),
        (570.5104531465563, 98.36296296296295),
        (574.3634369804378, 98.19259259259259),
        (575.9184972938554, 98.05185185185185),
        (579.0088082351692, 97.87407407407407),
        (580.5723584138102, 97.68888888888888),
        (582.8999964625561, 97.50370370370369),
        (589.7881071137995, 97.44444444444444),
        (605.8268774983197, 97.48148148148148),
        (629.4994516962043, 97.55555555555554),
        (653.9276238989705, 97.67407407407407),
        (676.8276203615268, 97.79259259259258),
        (699.7276168240828, 97.91111111111111),
        (724.1472991616257, 98.07407407407406),
        (743.9866992111499, 98.21481481481482),
        (766.8767908309455, 98.38518518518518),
        (788.2387067105309, 98.55555555555554),
    ],
    "PI": [
        (23.11507304821538, 99.97777777777777),
        (88.8252148997135, 99.98518518518517),
        (150.719162333298, 99.97037037037036),
        (210.31943117903003, 99.96296296296296),
        (274.5013972903181, 99.97037037037036),
        (334.10166613604997, 99.96296296296296),
        (393.7005200042448, 99.96296296296296),
        (451.77402808730403, 99.94814814814814),
        (513.670805475963, 99.91851851851851),
        (575.6255969436484, 99.58518518518518),
        (590.982348155223, 99.19259259259259),
        (600.2263964059571, 98.8),
        (606.4140931762707, 98.4074074074074),
        (615.665216314691, 97.97777777777777),
        (624.8597403516218, 97.84444444444443),
        (676.7823410803353, 98.02962962962962),
        (734.7950051292935, 98.33333333333333),
        (795.8484559057624, 98.71851851851851),
    ],
}

tga_fig = make_subplots(rows=1, cols=1, subplot_titles=["Digitized thermogravimetry"])
colors = ["#636EFA", "#EF553B", "#00CC96", "#AB63FA", "#FFA15A"]
for (name, points), color in zip(thermograv_data.items(), colors):
    xs, ys = zip(*points)
    add_trace_with_fit(
        tga_fig,
        1,
        1,
        name,
        xs,
        ys,
        degree=3,
        x_label="Temperature [°C]",
        y_label="Weight [%]",
        color=color,
        fit_type="sigmoid",
    )

tga_fig.update_layout(
    hovermode="x unified",
    xaxis_title="Temperature [°C]",
    yaxis_title="Weight [%]",
    legend=dict(orientation="h", y=-0.2),
)
st.plotly_chart(tga_fig, use_container_width=True)


st.header("Figure 3 – Dielectric Loss Factor (tan δ at 1 kHz, N₂)")
st.caption("Growth and peaking of loss tangent as temperature rises for different insulation chemistries.")
dielectric_data = {
    "PEI": [
        (23.65926181293227, 0.004757658771574102),
        (39.67593889379671, 0.0046485793361584),
        (56.59003253539032, 0.005309114421114863),
        (75.27525802072785, 0.005072233037601973),
        (92.18504233910065, 0.005298588842528049),
        (111.76445239275174, 0.005534222337691676),
        (122.4429553338648, 0.005530928491327911),
        (134.45950313503266, 0.005909663819570702),
        (145.59371700674407, 0.0073815145942933815),
        (155.40173665725794, 0.01102153643986481),
        (165.22052961582384, 0.020567941972485647),
        (175.48426019693605, 0.03838210264891108),
        (183.05897308827647, 0.047950998573442496),
        (195.06367025058714, 0.0400889927790342),
        (206.17418284458424, 0.030657261966395514),
        (215.95850121738383, 0.028025639830506426),
        (229.30447523216478, 0.026783167001519927),
        (243.54247915364888, 0.026761914781030575),
        (256.90138113809223, 0.03342304576174824),
        (269.3725625390532, 0.04364824820056133),
        (280.06938010385466, 0.06373187941837975),
        (285.8697291590356, 0.08902146393222489),
        (296.5687013854474, 0.13591113750188905),
        (306.38318502079244, 0.23198661556075953),
        (314.8639331193036, 0.40493781456740024),
        (322.4472646570855, 0.6046984554649337),
        (334.0393441210058, 0.9870365614921176),
        (346.5180668376032, 1.5067821342328305),
        (360.7722307211652, 2.103699847171867),
        (372.7984744995798, 2.7473585606308837),
        (380.81812501346667, 3.4322069246520863),
        (389.78367197431635, 13.672270471660534),
        (395.53985046648427, 7.653944095639783),
        (399.546443731012, 8.001266465464616),
    ],
    "PAI": [
        (26.356898149145664, 0.008494619943615046),
        (39.70394949473183, 0.008301098166959313),
        (53.053155501928444, 0.008481986061765503),
        (67.29439141582816, 0.009061673714943461),
        (82.4287345672362, 0.010350309859959219),
        (97.1192174269031, 0.012089108070773099),
        (110.92090237228243, 0.014439159671209078),
        (125.60599857792334, 0.015085399213790852),
        (137.61931438667557, 0.01507529878276622),
        (152.30117859990088, 0.01473076174263268),
        (167.87076339660857, 0.013765517016879569),
        (183.44250285492657, 0.013450246942033388),
        (194.56163409536535, 0.012294761527299311),
        (203.4614638770981, 0.012565791439201834),
        (215.0352287173299, 0.014038986645557444),
        (226.17482924306736, 0.019603990676706953),
        (235.98608088599687, 0.03129657103127978),
        (247.13860938139666, 0.05711207389651331),
        (257.85266423908126, 0.11914644849295751),
        (271.67805046217484, 0.23243592187864923),
        (281.9342397276507, 0.3710605155970243),
        (294.86113205921004, 0.605629197505857),
        (303.33972549611076, 1.0110247845934042),
        (316.2612311736441, 1.4760390359841524),
        (322.9428368274762, 1.7247758837481117),
        (335.4064769128008, 1.9268905116767732),
        (350.98683501756045, 2.250486437364158),
        (365.23238025468106, 2.6286216570684027),
        (377.7003296632263, 3.2106522161773925),
        (389.7254961108357, 4.100526553158507),
        (399.5184331300769, 4.480674870525023),
    ],
    "PEI/PAI": [
        (35.22763999913815, 0.00475459122362591),
        (48.58330999116589, 0.005553751105584546),
        (58.37516967960181, 0.005934785292347006),
        (69.05367262071493, 0.00593125303979875),
        (76.62084419641894, 0.006338973233124191),
        (88.63631466678157, 0.006623666328929357),
        (100.20792484540303, 0.0070774034315423656),
        (113.55820818340479, 0.00739471023989047),
        (124.23671112451791, 0.007390309072400543),
        (134.915214065631, 0.00738591052438787),
        (143.81719850897417, 0.007893037893423141),
        (154.49893344250285, 0.008434148438958499),
        (163.40630453987197, 0.010076446550708914),
        (170.5490077783284, 0.016451652187304003),
        (176.79321712525044, 0.022472508228713516),
        (185.2675012389304, 0.034313556212583904),
        (196.3941737950055, 0.03666502700652084),
        (205.28323026868625, 0.02998262877268824),
        (216.39805218590422, 0.025067945590518486),
        (225.74066492857295, 0.02450232522140994),
        (235.5292926245933, 0.024488956919449335),
        (247.99616470233352, 0.029251643110344137),
        (260.0331817888001, 0.047745656961034576),
        (272.5129818362026, 0.07453088867124298),
        (289.8914050548361, 0.12716307904563207),
        (307.72769386567836, 0.2835289728606099),
        (318.43097541531097, 0.4732586665954483),
        (331.3621770700911, 0.8445034969289931),
        (339.8461571610179, 1.5760952844844276),
        (351.8907155631208, 3.0072013285923114),
        (363.0335480812738, 4.489798419997184),
        (373.72066966882846, 5.363520129565086),
        (383.9563896490056, 5.604960246494363),
        (390.66169658055196, 10.697489066624719),
        (401.2960289586521, 4.284793834396994),
    ],
    "PI": [
        (22.726293335631638, 0.001949874588606959),
        (30.726551895024883, 0.001630538765234153),
        (42.29493008123072, 0.0016294874591014758),
        (55.645213419232505, 0.001702543555153082),
        (68.1034668505311, 0.0017013614116173836),
        (80.56602960505052, 0.001858813172827139),
        (92.13333046045119, 0.0018166465213988218),
        (102.81291073236946, 0.001856509073442511),
        (114.37913425696493, 0.0017743797081757272),
        (127.72510827174591, 0.001695715364059178),
        (137.0644890219991, 0.0015501934583990427),
        (149.96552541423367, 0.0014815048108245312),
        (162.86656180646824, 0.0014158597384115949),
        (172.6616534873198, 0.001617686805124646),
        (180.235289047855, 0.0019764149591870333),
        (188.2592488849626, 0.0026994610651345165),
        (197.6266402361509, 0.004406820033930901),
        (205.66029605050525, 0.007356836192951258),
        (212.35482967399972, 0.011234360642715838),
        (221.2718967486156, 0.016405193685159247),
        (231.08207106073988, 0.02561229103871367),
        (240.4462304195126, 0.03910578998016181),
        (253.36558143543553, 0.054601766911507525),
        (264.9533515761349, 0.08151926617837191),
        (276.53681239361356, 0.11131995207942552),
        (285.89127577513955, 0.13905890671470908),
        (294.81049751136584, 0.21232553120841316),
        (304.17357953933333, 0.3170367816896428),
        (316.6479929327098, 0.44267608170452905),
        (326.01107496067743, 0.6609878683728658),
        (333.58794251362815, 0.8634412437596083),
        (341.61082501993053, 1.1533112311850626),
        (351.4145353472236, 1.5750790813290099),
        (360.32621576781355, 2.057355513407926),
        (368.79295856585713, 2.6873677383031565),
        (374.5825343129861, 3.0033992354029575),
        (384.8247182779944, 3.5879543704008023),
        (398.62963521578934, 4.5819482737345485),
    ],
}

dielectric_fig = make_subplots(rows=1, cols=1, subplot_titles=["tan δ vs temperature"])
dielectric_colors = ["#636EFA", "#EF553B", "#00CC96", "#AB63FA"]
for (name, points), color in zip(dielectric_data.items(), dielectric_colors):
    xs, ys = zip(*points)
    add_trace_with_fit(
        dielectric_fig,
        1,
        1,
        name,
        xs,
        ys,
        degree=5,
        x_label="Temperature [°C]",
        y_label="tan δ",
        color=color,
    )

dielectric_fig.update_layout(
    hovermode="x unified",
    xaxis_title="Temperature [°C]",
    yaxis_title="tan δ",
    legend=dict(orientation="h", y=-0.2),
)
st.plotly_chart(dielectric_fig, use_container_width=True)


st.header("Figure 4 – Dynamic Mechanical Analysis (post-cure change)")
st.caption("Storage modulus evolution vs temperature for PEI after post-cure.")
dma_data = {
    "PEI 215°C": [
        (31.409621681578393, 0.0378900878496955),
        (51.668992273582525, 0.038143329982095686),
        (70.91602744131745, 0.041508917921692534),
        (90.7708437268125, 0.044882103125261086),
        (109.4094646714563, 0.04511508588706903),
        (128.8587769924458, 0.046920702291081584),
        (148.30745620810424, 0.04560131078127716),
        (158.84422823193938, 0.05510802043157503),
        (169.98846482086918, 0.06305982338893679),
        (185.18837416018576, 0.08981232225567837),
        (193.3047845036074, 0.15241377738497097),
        (199.00146627194655, 0.2712349859070753),
        (202.68107445571934, 0.43378098100937246),
        (205.34169960924737, 0.5666267388237913),
        (207.7987813988589, 0.6947824523461615),
        (210.4540251570734, 0.8010656428931392),
        (214.11812226023662, 0.8870489441069287),
        (218.169046720641, 0.8824120806626838),
        (220.58402700574098, 0.8027547679162476),
        (223.79197171791859, 0.6371698672251498),
        (227.60801410052196, 0.47315506775493243),
        (231.84095634358877, 0.3669579795329707),
        (236.47687012983724, 0.24982842845529896),
        (241.32455764930526, 0.17801402454929227),
        (248.80501368773722, 0.10154503024977257),
    ],
    "PEI 225°C": [
        (32.220313057924066, 0.03946272149189989),
        (51.87253563749908, 0.04283337427414469),
        (71.72671881766311, 0.0430815515638967),
        (90.36565631497243, 0.044877038282613135),
        (109.8152851886274, 0.04824515864353396),
        (128.8578273344493, 0.04223319042035656),
        (148.30650655010774, 0.040913798910552135),
        (167.35126456458812, 0.045839358385733275),
        (186.8015265435741, 0.052332486660470634),
        (206.05995760726702, 0.11194821704876678),
        (211.3489195424421, 0.21826432907295645),
        (214.00447985332212, 0.3261100235768424),
        (216.46567682758516, 0.47457828853902073),
        (218.52738433798703, 0.6511665598829006),
        (221.79167542462372, 0.7637073635214836),
        (225.86475857161307, 0.8684457770608209),
        (230.09516839335586, 0.7497486571835927),
        (232.90045811501753, 0.5966587233051135),
        (236.1178994071602, 0.4779489413212653),
        (238.73135821352864, 0.3779816095563451),
        (241.94784984767486, 0.25458431570177187),
        (247.5986314795165, 0.14684245047216993),
    ],
}

dma_fig = make_subplots(rows=1, cols=1, subplot_titles=["Post-cure storage modulus"])
dma_colors = ["#636EFA", "#EF553B"]
for (name, points), color in zip(dma_data.items(), dma_colors):
    xs, ys = zip(*points)
    add_trace_with_fit(
        dma_fig,
        1,
        1,
        name,
        xs,
        ys,
        degree=2,
        x_label="Temperature [°C]",
        y_label="Storage modulus [GPa]",
        color=color,
        fit_type="elliptic",
    )

dma_fig.update_layout(
    hovermode="x unified",
    xaxis_title="Temperature [°C]",
    yaxis_title="Storage modulus [GPa]",
    legend=dict(orientation="h", y=-0.2),
)
st.plotly_chart(dma_fig, use_container_width=True)


st.header("Figure 5 – Capacitance Change During Thermal Aging of Twisted Pairs")
st.caption("Capacitance drift vs time at two stress temperatures.")
capacitance_data = {
    "270°C": [
        (0, 11.406278598509608),
        (56.06451823767816, 16.8827297685972),
        (179.79311021048514, 19.330369983004314),
        (242.49820237939608, 19.886374035821675),
        (307.02787946136755, 20.863920120277157),
        (362.56618512223827, 21.350356255719703),
        (425.21408027193104, 21.203490652372857),
        (482.63988756700235, 22.88462544123415),
        (543.6519479670546, 24.635687671591057),
        (601.1177931755788, 26.80883121976729),
        (658.3205320956989, 25.74877434958818),
        (721.0084651588444, 26.09391750555628),
    ],
    "250°C": [
        (0, -15.302229049548963),
        (82.67257157798414, -8.142306183814881),
        (179.38129167211403, -7.730291541377959),
        (276.17008759314956, -6.334259380311153),
        (376.40214407112046, -6.625473918159237),
        (469.570368675644, -5.72109099228657),
        (568.0521963655382, -5.520117008759321),
        (663.1079226042622, -3.4210354294679064),
        (752.6841744018828, -2.6568669107072864),
    ],
}

cap_fig = make_subplots(rows=1, cols=1, subplot_titles=["Capacitance drift vs time"])
cap_colors = ["#636EFA", "#EF553B"]
for (name, points), color in zip(capacitance_data.items(), cap_colors):
    xs, ys = zip(*points)
    add_trace_with_fit(
        cap_fig,
        1,
        1,
        name,
        xs,
        ys,
        degree=3,
        x_label="Ageing time [h]",
        y_label="Capacitance change [pF]",
        color=color,
    )

cap_fig.update_layout(
    hovermode="x unified",
    xaxis_title="Ageing time [h]",
    yaxis_title="Capacitance change [pF]",
    legend=dict(orientation="h", y=-0.2),
)
st.plotly_chart(cap_fig, use_container_width=True)


st.info(
    "Fit coefficients are displayed inside each subplot for quick reference. Hover over any curve to "
    "inspect precise values along the original digitized data and fitted lines."
)
